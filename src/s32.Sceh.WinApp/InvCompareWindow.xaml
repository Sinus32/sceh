<Window x:Class="s32.Sceh.WinApp.InvCompareWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:s32.Sceh.WinApp"
    xmlns:ctl="clr-namespace:s32.Sceh.WinApp.Controls"
    xmlns:resx="clr-namespace:s32.Sceh.WinApp.Translations"
    xmlns:code="clr-namespace:s32.Sceh.Code;assembly=ScehLib"
    xmlns:dm="clr-namespace:s32.Sceh.DataModel;assembly=ScehLib"
    xmlns:ds="clr-namespace:s32.Sceh.DataStore;assembly=ScehLib"
    Title="InvCompareWindow" Height="450" Width="970" Icon="Img/sceh.ico" ResizeMode="CanResizeWithGrip" WindowState="Maximized">
  <Window.Resources>
    <CollectionViewSource x:Key="steamAppsView" Source="{Binding SteamApps}" Filter="CollectionViewSource_FilterByHideProp" />
    <ContextMenu x:Key="steamAppMenu" FlowDirection="LeftToRight" DataContext="{Binding PlacementTarget, RelativeSource={RelativeSource Self}}">
      <MenuItem Header="{x:Static resx:Strings.CardContextMenu_BadgePage}" Command="local:InvCompareWindow.OpenBadgePageCommand"
        CommandParameter="{Binding DataContext}" />
      <MenuItem Header="{x:Static resx:Strings.CardContextMenu_TradingForum}" Command="local:InvCompareWindow.OpenTradingForumCommand"
        CommandParameter="{Binding DataContext}" />
      <Separator />
      <MenuItem Header="{x:Static resx:Strings.CardContextMenu_StorePage}" Command="local:InvCompareWindow.OpenStorePageCommand"
        CommandParameter="{Binding DataContext}" />
    </ContextMenu>
    <ContextMenu x:Key="cardMenu" FlowDirection="LeftToRight" DataContext="{Binding PlacementTarget, RelativeSource={RelativeSource Self}}">
      <MenuItem Header="{x:Static resx:Strings.CardContextMenu_MarketPage}" Command="local:InvCompareWindow.OpenMarketPageCommand"
        CommandParameter="{Binding DataContext}" />
      <Separator />
      <MenuItem Header="{x:Static resx:Strings.CardContextMenu_BadgePage}" Command="local:InvCompareWindow.OpenBadgePageCommand"
        CommandParameter="{Binding DataContext}" />
      <MenuItem Header="{x:Static resx:Strings.CardContextMenu_StorePage}" Command="local:InvCompareWindow.OpenStorePageCommand"
        CommandParameter="{Binding DataContext}" />
      <Separator />
      <MenuItem Header="{x:Static resx:Strings.CardContextMenu_TradingForum}" Command="local:InvCompareWindow.OpenTradingForumCommand"
        CommandParameter="{Binding DataContext}" />
    </ContextMenu>
    <DataTemplate x:Key="steamAppTemplate" DataType="dm:SteamApp">
      <Grid ContextMenu="{StaticResource steamAppMenu}">
        <Grid.Resources>
          <CollectionViewSource x:Key="myCardsView" Source="{Binding MyCards}" Filter="CollectionViewSource_FilterByHideProp" />
          <CollectionViewSource x:Key="otherCardsView" Source="{Binding OtherCards}" Filter="CollectionViewSource_FilterByHideProp" />
          <DataTemplate x:Key="cardTemplate" DataType="dm:Card">
            <ToggleButton Margin="2" IsChecked="{Binding IsSelected}" ToolTip="{Binding Name}" ContextMenu="{StaticResource cardMenu}">
              <Grid Width="83" Height="96">
                <ctl:LazyImage Name="CardImage" ImageFile="{Binding Converter={StaticResource cardImageFileConv}}" Stretch="UniformToFill"
                  Source="{Binding LazySource, RelativeSource={RelativeSource Self}, TargetNullValue={StaticResource defaultCard}, Mode=OneWay}" />
                <TextBlock Text="{Binding Name}" FontSize="11" Width="74" Height="60" Margin="0,12,0,0"
                  TextAlignment="Center" VerticalAlignment="Top" TextWrapping="WrapWithOverflow"
                  Visibility="{Binding IsReady, ElementName=CardImage, Converter={StaticResource hideToVisibilityConv}}" />
              </Grid>
            </ToggleButton>
          </DataTemplate>
        </Grid.Resources>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="1*" />
          <ColumnDefinition Width="1*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
          <RowDefinition />
          <RowDefinition />
        </Grid.RowDefinitions>
        <TextBlock Text="{Binding Name}" Grid.ColumnSpan="2" TextAlignment="Center" />
        <ItemsControl Grid.Row="1" Grid.Column="0" ItemsSource="{Binding Source={StaticResource myCardsView}}" ItemTemplate="{StaticResource cardTemplate}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Orientation="Horizontal" FlowDirection="LeftToRight" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
        </ItemsControl>
        <ItemsControl Grid.Row="1" Grid.Column="1" ItemsSource="{Binding Source={StaticResource otherCardsView}}" ItemTemplate="{StaticResource cardTemplate}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Orientation="Horizontal" FlowDirection="RightToLeft" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
        </ItemsControl>
      </Grid>
    </DataTemplate>
  </Window.Resources>
  <Window.CommandBindings>
    <CommandBinding Command="local:InvCompareWindow.CompareCommand" CanExecute="CompareCommand_CanExecute" Executed="CompareCommand_Executed" />
    <CommandBinding Command="local:InvCompareWindow.ShowHideCardsCommand" CanExecute="ShowHideCardsCommand_CanExecute" Executed="ShowHideCardsCommand_Executed" />
    <CommandBinding Command="local:InvCompareWindow.OpenMarketPageCommand" CanExecute="OpenMarketPageCommand_CanExecute" Executed="OpenMarketPageCommand_Executed" />
    <CommandBinding Command="local:InvCompareWindow.OpenStorePageCommand" CanExecute="OpenStorePageCommand_CanExecute" Executed="OpenStorePageCommand_Executed" />
    <CommandBinding Command="local:InvCompareWindow.OpenBadgePageCommand" CanExecute="OpenBadgePageCommand_CanExecute" Executed="OpenBadgePageCommand_Executed" />
    <CommandBinding Command="local:InvCompareWindow.OpenTradingForumCommand" CanExecute="OpenTradingForumCommand_CanExecute" Executed="OpenTradingForumCommand_Executed" />
  </Window.CommandBindings>
  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="40" />
      <ColumnDefinition Width="3*" />
      <ColumnDefinition Width="2*" />
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    <Menu Grid.Row="0" Grid.ColumnSpan="3">
      <MenuItem Header="{x:Static resx:Strings.MenuItem_MyProfile}">
        <MenuItem Header="{x:Static resx:Strings.MenuItem_Inventory}" />
        <MenuItem Header="{x:Static resx:Strings.MenuItem_Badges}" />
        <Separator />
        <MenuItem Header="{x:Static resx:Strings.MenuItem_ChangeProfile}" />
        <MenuItem Header="{x:Static resx:Strings.MenuItem_Exit}" />
      </MenuItem>
      <MenuItem Header="{x:Static resx:Strings.MenuItem_OthersProfile}">
      </MenuItem>
    </Menu>
    <ctl:LazyImage ImageFile="{Binding OwnerProfile.AvatarSmallUrl, Converter={StaticResource avatarImageFileConv}}" Stretch="None"
        Source="{Binding LazySource, RelativeSource={RelativeSource Self}, TargetNullValue={StaticResource defaultAvatar}, Mode=OneWay}"
        Grid.Row="1" Grid.RowSpan="2" />
    <TextBlock Text="{Binding OwnerProfile.Name}" VerticalAlignment="Center" FontSize="16" Margin="2" Grid.Row="1" Grid.Column="1" />
    <TextBlock Text="{Binding RequestCount, Source={x:Static code:SteamDataDownloader.Info}, StringFormat={x:Static resx:Strings.RequestCountFormat}}"
        VerticalAlignment="Center" FontSize="16" TextAlignment="Right" Margin="2" Grid.Row="1" Grid.Column="2">
      <TextBlock.Style>
        <Style TargetType="TextBlock">
          <Setter Property="Foreground" Value="#BACBD1" />
          <Style.Triggers>
            <DataTrigger Binding="{Binding IsRepeating, Source={x:Static code:SteamDataDownloader.Info}}" Value="True">
              <Setter Property="Foreground" Value="#DE4426" />
              <Setter Property="FontWeight" Value="ExtraBold" />
            </DataTrigger>
            <DataTrigger Binding="{Binding IsInProgress, Source={x:Static code:SteamDataDownloader.Info}}" Value="True">
              <Setter Property="Foreground" Value="#38A800" />
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </TextBlock.Style>
    </TextBlock>
    <ctl:LazyImage ImageFile="{Binding SecondProfile.AvatarSmallUrl, Converter={StaticResource avatarImageFileConv}}" Stretch="Uniform"
        Source="{Binding LazySource, RelativeSource={RelativeSource Self}, TargetNullValue={StaticResource defaultAvatar}, Mode=OneWay}"
        Grid.Row="3" Height="26" />
    <TextBlock Text="{Binding SecondProfile.Name}" VerticalAlignment="Center" FontSize="16" Margin="2" Grid.Row="3" Grid.Column="1" />
    <ComboBox x:Name="cbOtherProfile" IsEditable="True" ItemsSource="{Binding SteamProfiles}"
        VerticalAlignment="Center" TextSearch.TextPath="CustomUrlOrSteamId" Grid.Row="2" Grid.Column="1" />
    <Button x:Name="btnCompare" Command="local:InvCompareWindow.CompareCommand" Content="{x:Static resx:Strings.CompareButtonText}"
        HorizontalAlignment="Left" Grid.Row="2" Grid.Column="2" Margin="10,0,0,0" Padding="20,2" />
    <StackPanel Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2"
        Orientation="Horizontal" HorizontalAlignment="Right">
      <TextBlock Text="{Binding ErrorMessage}" TextWrapping="Wrap" />
      <Button Command="local:InvCompareWindow.ShowHideCardsCommand" CommandParameter="{x:Static code:CardsCompareManager.ShowTradeSugestionsStrategy}" Margin="2">
        <Image Source="Img/selection1.png" Stretch="None" />
      </Button>
      <Button Command="local:InvCompareWindow.ShowHideCardsCommand" CommandParameter="{x:Static code:CardsCompareManager.ShowMyCardsStrategy}" Margin="2">
        <Image Source="Img/selection2.png" Stretch="None" />
      </Button>
      <Button Command="local:InvCompareWindow.ShowHideCardsCommand" CommandParameter="{x:Static code:CardsCompareManager.ShowAllStrategy}" Margin="2">
        <Image Source="Img/selection3.png" Stretch="None" />
      </Button>
      <Button Command="local:InvCompareWindow.ShowHideCardsCommand" CommandParameter="{x:Static code:CardsCompareManager.ShowOtherCardsStrategy}" Margin="2">
        <Image Source="Img/selection4.png" Stretch="None" />
      </Button>
      <Button Command="local:InvCompareWindow.ShowHideCardsCommand" CommandParameter="{x:Static code:CardsCompareManager.ShowSelectedAppStrategy}" Margin="2">
        <Image Source="Img/selection5.png" Stretch="None" />
      </Button>
      <Button Command="local:InvCompareWindow.ShowHideCardsCommand" CommandParameter="{x:Static code:CardsCompareManager.ShowOnlySelectedStrategy}" Margin="2">
        <Image Source="Img/selection6.png" Stretch="None" />
      </Button>
    </StackPanel>
    <ItemsControl Grid.Row="4" Grid.ColumnSpan="3"
        ItemsSource="{Binding Source={StaticResource steamAppsView}}" VirtualizingStackPanel.IsVirtualizing="True" VirtualizingStackPanel.VirtualizationMode="Recycling"
        ScrollViewer.CanContentScroll="True" BorderBrush="{DynamicResource {x:Static SystemColors.ActiveCaptionBrushKey}}"
        BorderThickness="0,1" ItemTemplate="{StaticResource steamAppTemplate}">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <VirtualizingStackPanel />
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.Template>
        <ControlTemplate>
          <Border SnapsToDevicePixels="True"
              BorderThickness="{TemplateBinding Border.BorderThickness}"
              Padding="{TemplateBinding Control.Padding}"
              BorderBrush="{TemplateBinding Border.BorderBrush}"
              Background="{TemplateBinding Panel.Background}">
            <ScrollViewer Focusable="False" Padding="{TemplateBinding Control.Padding}">
              <ItemsPresenter SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
            </ScrollViewer>
          </Border>
        </ControlTemplate>
      </ItemsControl.Template>
    </ItemsControl>
    <StatusBar Grid.Row="5" Grid.ColumnSpan="3">
      <StatusBarItem>
        <TextBlock />
      </StatusBarItem>
    </StatusBar>
  </Grid>
</Window>